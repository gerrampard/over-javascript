# 08-鉴权-3-JWT

## 一 JWT 简介

JWT (Json Web Token) 是目前非常流行的鉴权方案。官网地址为：<https://jwt.io/>

在官网中，可以看到 JWT 加密解密的结果如下所示：

![jwt 加密解密对比](../images/node/jwt-01.png)

解析上图：

- Token：即左侧区域内容，是按照指定的算法（图中是 hash256）生成的字符串。字符串的颜色分别对应右侧解密后的部分。
- Header：放置 JWT 的一些基本信息
- Payload：称为载荷，也即数据，是真实的状态信息，如账户、密码、sessionID
- Verify Signature：加密方式，即将 Header、Payload、私钥三部分加密

## 二 JWT 的使用

### 2.0 JWT 鉴权的流程

```txt
1 用户登录，此时服务端产生 JWT 的 Token，并将该 Token 返回
2 前端接收到 Token 后，保存该 Token（存储于Cookie、localStorage均可）
3 后续每次请求，携带该 Token （请求头、Cookie中均可携带）
4 服务端每次收到请求，解密 Token，验证 Token 是否合法（其实是验证Token中的账号密码/SID是否合法）
```

JWT 的鉴权方式，非常适用于 无状态请求、第三方登录等场景。

### 2.1 Token 的创建

Token 的创建可以依据需求，使用非对称加密、对称加密均可。

对称方式：
![对称加密产生Token](../images/node/jwt-02.png)

参数 payload 为一个对象：

```js
let payload = {
  usrename: abc,
  password: 134,
}
```

非对称加密方式（利用私钥产生 Token）：
![非对称加密产生Token](../images/node/jwt-03.png)

## 三 Auth2 示例

### 3.0 Auth2 概念

案例：假如现在要访问百度文库内的文章信息，但是该文章信息需要登录后才能访问，用户在弹出的登录界面中使用 QQ 快速登录，即采用了 Auth2。

这里的登录中，通过授权，百度获取了 QQ 用户的账户信息、头像信息等，从而使用该信息进行百度系统的登录。

不过要注意的是，百度获的 QQ 账户只是临时令牌，而不是真实的用户账号密码。Auth2 最大的好处是：用户授权了多个应用后，可以防止因为某一个应用被破解导致所有应用信息都被窃取的状况。

弹出的授权地址类似：

```txt
https://graph.qq.com/oauth2.0/show?which=Login&display=pc
&client_id=100312028
&response_type=code
&redirect_uri=https%3A%2F%2Fpassport.baidu.com%2Fphoenix%2Faccount%2Fafterauth%3Fmkey%3D62bfd19b1fafe
&display=page
&scope=get_user_info%2Cadd_share%2Cget_other_info%2Cget_fanslist%2Cget_idollist%2Cadd_idol%2Cget_simple_userinfo
```
